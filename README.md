# What's this?
This is a simple script which makes repository created as new in GitHub organization protected automatically. This project enables IT department that manages own company organization to automate applying protection rule to all of new repository.

You need Google account (Google Workspace account) only, no need any servers.

# Requirement
- Google account (or Google Workspace account)
- GitHub account (Organization owner permission)

# How it works
This script works as Google Apps Script (GAS) so that you could handle webhook event sent by GitHub.

![sequence dialog](http://www.plantuml.com/plantuml/proxy?src=https://gist.githubusercontent.com/waysaku/0b9e5b91b0329506eac7793f454ed173/raw/5b02b9f85666e161ab26ac01d05748e0a0fdf5f0/github_auto_protection_diagram) https://gist.github.com/waysaku/0b9e5b91b0329506eac7793f454ed173

# Setting up
## Deploy script into GAS environment
You need to put all of files into GAS project you create as new. You can use [clasp](https://github.com/google/clasp) to do it easier. 

### Set a GitHub Token
You have to set your GitHub Token into `main.gs#1` . The GitHub Token is generated by your [account page](https://docs.github.com/ja/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token)

### Edit protection rules
You have to set protection rules you want into `service.gs#43` .

### Publish as web application
All of above are done, you could publish the GAS project as web application which can be accessed by anyone.
NOTE. You have to set web application setting as follows.
- Execute the app as: Me
- Who has access to the app: Anyone, even anonymous
Then, you could see a `Current web app URL` .

## Set-up webhook event on GitHub
Open organization settings page. Then you could click `Webhooks` on left menu, click `Add webhook` to create new webhook. You have to set as follows.
- Payload URL: set the GAS project URL which are shown when you published above.
- Which events would you like to trigger this webhook?: select `Let me select individual events.` and check only `Branch or tag creation` .
